<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>VR Experience</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
      <style>
      /* ===== Custom loading overlay (black screen + spinner) ===== */
      #startOverlay{position:fixed;inset:0;background:#000;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999}
      #spinner{width:56px;height:56px;border-radius:50%;border:6px solid #333;border-top-color:#fff;animation:spin 1s linear infinite}
      #loadingText{color:#fff;margin:16px 0 10px 0;font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial}
      #startBtn{display:none;padding:10px 16px;border-radius:10px;border:0;background:#1e90ff;color:#fff;font-weight:600}
      @keyframes spin{to{transform:rotate(360deg)}}
    </style>
  </head>
  <body>
    <!-- ===== Loading overlay shown until a-assets are loaded ===== -->
    <div id="startOverlay">
      <div id="spinner"></div>
      <div id="loadingText">Loading assetsâ€¦</div>
      <button id="startBtn" type="button">Enter</button>
    </div>

<a-scene cursor="rayOrigin: mouse" raycaster="objects: .clickable" loading-screen="enabled: false">
      <!-- Camera + Cursor (supports Google Cardboard gaze + tap) -->
      <a-entity id="cameraRig">
        <a-camera position="0 1.6 0" wasd-controls-enabled="false">
          <a-cursor
            id="cursor"
            fuse="true"
            fuse-timeout="1000"
            material="color: white; shader: flat"
          ></a-cursor>
        </a-camera>
      </a-entity>

      <!-- Background Sky -->
      <a-sky id="sky" src="#scene1Img"></a-sky>

      <!-- Assets -->
      <a-assets>
        <!-- Images -->
        <img id="scene1Img" src="assets/scene1.jpg" />
        <img id="scene2Img" src="assets/scene2.jpg" />
        <img id="scene3AImg" src="assets/scene3A.jpg" />
        <img id="scene3BImg" src="assets/scene3B.jpg" />
        <img id="videoThumb" src="assets/video_thumbnail.jpg" />

        <!-- Audio -->
        <audio id="audioIntro" src="assets/audio_intro.mp3"></audio>
        <audio id="audioScene2" src="assets/audio_scene2.mp3"></audio>
        <audio id="audioScene3A" src="assets/audio_scene3A.mp3"></audio>
        <audio id="audioScene3B" src="assets/audio_scene3B.mp3"></audio>
        <audio id="audioQuiz" src="assets/audio_quiz.mp3"></audio>
        <audio id="clickSound" src="assets/ui_click.mp3"></audio>

        <!-- Video -->
        <video
          id="video"
          src="assets/video.mp4"
          preload="auto"
          crossorigin="anonymous"
          webkit-playsinline
          playsinline
        ></video>
      </a-assets>

      <!-- Scene 1 Button -->
      <a-entity
        id="enterBtn"
        geometry="primitive: plane; height: 0.5; width: 1.5"
        material="color: blue"
        text="value: Enter; align: center; color: white"
        position="0 1.6 -3"
        class="clickable"
      ></a-entity>

      <!-- Video Thumbnail (Scene 2) -->
      <a-plane
        id="videoThumbPlane"
        src="#videoThumb"
        height="1"
        width="1.78"
        position="0 1.6 -3"
        visible="false"
        class="clickable"
      ></a-plane>

      <!-- Video Screen -->
      <a-video
        id="videoScreen"
        src="#video"
        height="1"
        width="1.78"
        position="0 1.6 -3"
        visible="false"
      ></a-video>

      <!-- Quiz Buttons -->
      <a-entity
        id="yesBtn"
        geometry="primitive: plane; height: 0.5; width: 1"
        material="color: green"
        text="value: Yes; align: center; color: white"
        position="-1 1.6 -3"
        visible="false"
        class="clickable"
      ></a-entity>

      <a-entity
        id="noBtn"
        geometry="primitive: plane; height: 0.5; width: 1"
        material="color: red"
        text="value: No; align: center; color: white"
        position="1 1.6 -3"
        visible="false"
        class="clickable"
      ></a-entity>
    </a-scene>

    <script>
      const sky = document.getElementById("sky");

      // Buttons
      const enterBtn = document.getElementById("enterBtn");
      const videoThumbPlane = document.getElementById("videoThumbPlane");
      const videoScreen = document.getElementById("videoScreen");
      const yesBtn = document.getElementById("yesBtn");
      const noBtn = document.getElementById("noBtn");

      // Media
      const audioIntro = document.getElementById("audioIntro");
      const audioScene2 = document.getElementById("audioScene2");
      const audioScene3A = document.getElementById("audioScene3A");
      const audioScene3B = document.getElementById("audioScene3B");
      const audioQuiz = document.getElementById("audioQuiz");
      const clickSound = document.getElementById("clickSound");
      const video = document.getElementById("video");

      function stopAllAudio() {
        [audioIntro, audioScene2, audioScene3A, audioScene3B, audioQuiz].forEach(
          (a) => {
            a.pause();
            a.currentTime = 0;
          }
        );
      }

      // Scene 1
      function startScene1() {
        sky.setAttribute("src", "#scene1Img");
        enterBtn.setAttribute("visible", true);
        stopAllAudio();
        audioIntro.play();
      }

      // Scene 2
      function startScene2() {
        sky.setAttribute("src", "#scene2Img");
        enterBtn.setAttribute("visible", false);
        videoThumbPlane.setAttribute("visible", true);
        stopAllAudio();
        audioScene2.play();
      }

      // Scene 3A
      function startScene3A() {
        sky.setAttribute("src", "#scene3AImg");
        yesBtn.setAttribute("visible", false);
        noBtn.setAttribute("visible", false);
        stopAllAudio();
        audioScene3A.play();
      }

      // Scene 3B
      function startScene3B() {
        sky.setAttribute("src", "#scene3BImg");
        yesBtn.setAttribute("visible", false);
        noBtn.setAttribute("visible", false);
        stopAllAudio();
        audioScene3B.play();
      }

      // Click / Gaze Interactions
      enterBtn.addEventListener("click", () => {
        clickSound.play();
        startScene2();
      });

      videoThumbPlane.addEventListener("click", () => {
        clickSound.play();
        videoThumbPlane.setAttribute("visible", false);
        videoScreen.setAttribute("visible", true);
        stopAllAudio();
        video.play();
      });

      video.addEventListener("ended", () => {
        videoScreen.setAttribute("visible", false);
        yesBtn.setAttribute("visible", true);
        noBtn.setAttribute("visible", true);
        audioQuiz.play();
      });

      yesBtn.addEventListener("click", () => {
        clickSound.play();
        startScene3A();
      });

      noBtn.addEventListener("click", () => {
        clickSound.play();
        startScene3B();
      });

      // ===== Start experience via overlay after assets are ready =====
      (function(){
        const overlay = document.getElementById('startOverlay');
        const startBtn = document.getElementById('startBtn');
        const loadingText = document.getElementById('loadingText');
        const spinner = document.getElementById('spinner');
        const assets = document.querySelector('a-assets');

        function showEnter(){
          if (spinner) spinner.style.display = 'none';
          if (loadingText) loadingText.textContent = 'Ready';
          if (startBtn) startBtn.style.display = 'inline-block';
        }

        if (assets && assets.hasLoaded) {
          showEnter();
        } else if (assets) {
          assets.addEventListener('loaded', showEnter, {once:true});
        } else {
          // Fallback: if no a-assets found, allow entering immediately
          showEnter();
        }

        function begin(){
          if (overlay) overlay.style.display = 'none';
          // Start Scene 1 only after user interaction to satisfy mobile audio policies
          startScene1();
        }
        if (startBtn){
          startBtn.addEventListener('click', begin, {once:true});
          startBtn.addEventListener('touchstart', begin, {once:true});
        }
      })();
    </script>
  </body>
</html>
