<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>VR Experience</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/ngokevin/kframe@master/components/event-set/dist/aframe-event-set-component.min.js"></script>
  </head>
  <body>
    <a-scene vr-mode-ui="enabled: true">

      <!-- Assets -->
      <a-assets>
        <img id="scene1" src="assets/scene1.jpg">
        <img id="scene2" src="assets/scene2.jpg">
        <img id="videoThumb" src="assets/video_thumbnail.jpg">

        <video id="videoFile" src="assets/video.mp4" preload="auto" crossorigin="anonymous"></video>

        <audio id="audioIntro" src="assets/audio_intro.mp3"></audio>
        <audio id="audioScene2" src="assets/audio_scene2.mp3"></audio>
      </a-assets>

      <!-- Sky -->
      <a-sky id="sky" src="#scene1"></a-sky>

      <!-- Camera with gaze + click -->
      <a-entity id="rig">
        <a-camera>
          <a-cursor 
            fuse="true" 
            fuse-timeout="1500"
            material="color: white; shader: flat"
            geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03">
          </a-cursor>
        </a-camera>
      </a-entity>

      <!-- Enter Button (Scene 1) -->
      <a-entity id="enterButton" class="clickable"
        geometry="primitive: plane; height: 0.5; width: 1"
        material="color: #4CAF50"
        position="0 -1.5 -3"
        text="value: Enter; align: center; color: white"
        event-set__mouseenter="scale: 1.2 1.2 1"
        event-set__mouseleave="scale: 1 1 1">
      </a-entity>

      <!-- Video Thumbnail (Scene 2) -->
      <a-entity id="videoThumbnail" class="clickable"
        geometry="primitive: plane; height: 1; width: 1.78"
        material="src: #videoThumb"
        position="0 0 -3"
        visible="false"
        event-set__mouseenter="scale: 1.05 1.05 1"
        event-set__mouseleave="scale: 1 1 1">
      </a-entity>

      <!-- Video Screen -->
      <a-video id="videoScreen" src="#videoFile" width="4" height="2.25" position="0 0 -4" visible="false"></a-video>

    </a-scene>

    <script>
      let currentAudio = null;

      function playAudio(id) {
        stopCurrentAudio();
        const audio = document.querySelector(id);
        audio.currentTime = 0;
        audio.play();
        currentAudio = audio;
      }

      function stopCurrentAudio() {
        if (currentAudio) {
          currentAudio.pause();
          currentAudio.currentTime = 0;
          currentAudio = null;
        }
      }

      // Scene 1: Start audio
      window.addEventListener('load', () => {
        playAudio('#audioIntro');
      });

      // Enter Button → Scene 2
      const enterButton = document.querySelector('#enterButton');
      enterButton.addEventListener('click', goToScene2);
      enterButton.addEventListener('touchstart', goToScene2); // mobile tap

      function goToScene2() {
        stopCurrentAudio();
        document.querySelector('#sky').setAttribute('src', '#scene2');
        document.querySelector('#enterButton').setAttribute('visible', false);
        document.querySelector('#videoThumbnail').setAttribute('visible', true);
        playAudio('#audioScene2');
      }

      // Video Thumbnail → Play video
      const videoThumbnail = document.querySelector('#videoThumbnail');
      videoThumbnail.addEventListener('click', playVideo);
      videoThumbnail.addEventListener('touchstart', playVideo);

      function playVideo() {
        stopCurrentAudio();
        document.querySelector('#videoThumbnail').setAttribute('visible', false);
        const videoScreen = document.querySelector('#videoScreen');
        videoScreen.setAttribute('visible', true);
        const videoFile = document.querySelector('#videoFile');
        videoFile.play();
      }
    </script>
  </body>
</html>
